# Migration `20201126124553-minor-bugs-fix`

This migration has been generated by MikhailKochkin at 11/26/2020, 3:45:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "_CoursePageToCoursePage" DROP CONSTRAINT "_CoursePageToCoursePage_A_fkey"

ALTER TABLE "_CoursePageToCoursePage" DROP CONSTRAINT "_CoursePageToCoursePage_B_fkey"

ALTER TABLE "CoursePage" DROP CONSTRAINT "CoursePage_company_fkey"

ALTER TABLE "CoursePage" DROP COLUMN "company",
ADD COLUMN     "companyId" TEXT

DROP TABLE "_CoursePageToCoursePage"

ALTER TABLE "CoursePage" ADD FOREIGN KEY("companyId")REFERENCES "Company"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201125143639-init..20201126124553-minor-bugs-fix
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Application {
   id            String     @id @default(cuid())
@@ -135,9 +135,9 @@
   price                 Int?
   discountPrice         Int?
   createdAt             DateTime          @default(now())
   updatedAt             DateTime          @updatedAt
-  company               String?
+  companyId               String?
   weeks                 Int?
   subscription          Boolean?          @default(false)
   subscriptionPrice     Int?
   batch                 String?
@@ -146,20 +146,18 @@
   students              String[]
   promocode             Json[]
   userId                String
   uniId                 String?
-  Company               Company?          @relation(fields: [company], references: [id])
+  company               Company?          @relation(fields: [companyId], references: [id])
   uni                   Uni?              @relation(fields: [uniId], references: [id])
-  User_CoursePageToUser User              @relation(fields: [userId], references: [id])
+  user                  User              @relation(fields: [userId], references: [id])
   applications          Application[]
   visits                CourseVisit[]
   lessons               Lesson[]
   orders                Order[]
   authors               User[]            @relation("AuthorsCoursePage")
   careerTrackUnit       CareerTrackUnit[]
   careerTrack           CareerTrack[]     @relation("CoursePageForCareer")
-  CoursePage_B          CoursePage[]      @relation("CoursePageToCoursePage")
-  CoursePage_A          CoursePage[]      @relation("CoursePageToCoursePage")
   posts                 Post[]            @relation("PostCoursePages")
   new_students          User[]            @relation("UserSubjects")
 }
@@ -571,9 +569,9 @@
   challengeResults            ChallengeResult[]
   clauses                     Clause[]
   construction                Construction[]
   constructionResults         ConstructionResult[]
-  coursePage                  CoursePage[]
+  coursePages                 CoursePage[]
   courseVisits                CourseVisit[]
   documents                   Document[]
   documentResults             DocumentResult[]
   teacherFeedback             Feedback[]           @relation("TeacherFeedback")
```


